var data14 = {"name":null,"index":[["Fri",0],["Fri",1],["Fri",2],["Fri",3],["Fri",4],["Fri",5],["Fri",6],["Fri",7],["Fri",8],["Fri",9],["Fri",10],["Fri",11],["Fri",12],["Fri",13],["Fri",14],["Fri",15],["Fri",16],["Fri",17],["Fri",18],["Fri",19],["Fri",20],["Fri",21],["Fri",22],["Fri",23],["Mon",0],["Mon",1],["Mon",2],["Mon",3],["Mon",4],["Mon",5],["Mon",6],["Mon",7],["Mon",8],["Mon",9],["Mon",10],["Mon",11],["Mon",12],["Mon",13],["Mon",14],["Mon",15],["Mon",16],["Mon",17],["Mon",18],["Mon",19],["Mon",20],["Mon",21],["Mon",22],["Mon",23],["Sat",0],["Sat",1],["Sat",2],["Sat",3],["Sat",4],["Sat",5],["Sat",6],["Sat",7],["Sat",8],["Sat",9],["Sat",10],["Sat",11],["Sat",12],["Sat",13],["Sat",14],["Sat",15],["Sat",16],["Sat",17],["Sat",18],["Sat",19],["Sat",20],["Sat",21],["Sat",22],["Sat",23],["Sun",0],["Sun",1],["Sun",2],["Sun",3],["Sun",4],["Sun",5],["Sun",6],["Sun",7],["Sun",8],["Sun",9],["Sun",10],["Sun",11],["Sun",12],["Sun",13],["Sun",14],["Sun",15],["Sun",16],["Sun",17],["Sun",18],["Sun",19],["Sun",20],["Sun",21],["Sun",22],["Sun",23],["Thu",0],["Thu",1],["Thu",2],["Thu",3],["Thu",4],["Thu",5],["Thu",6],["Thu",7],["Thu",8],["Thu",9],["Thu",10],["Thu",11],["Thu",12],["Thu",13],["Thu",14],["Thu",15],["Thu",16],["Thu",17],["Thu",18],["Thu",19],["Thu",20],["Thu",21],["Thu",22],["Thu",23],["Tue",0],["Tue",1],["Tue",2],["Tue",3],["Tue",4],["Tue",5],["Tue",6],["Tue",7],["Tue",8],["Tue",9],["Tue",10],["Tue",11],["Tue",12],["Tue",13],["Tue",14],["Tue",15],["Tue",16],["Tue",17],["Tue",18],["Tue",19],["Tue",20],["Tue",21],["Tue",22],["Tue",23],["Wed",0],["Wed",1],["Wed",2],["Wed",3],["Wed",4],["Wed",5],["Wed",6],["Wed",7],["Wed",8],["Wed",9],["Wed",10],["Wed",11],["Wed",12],["Wed",13],["Wed",14],["Wed",15],["Wed",16],["Wed",17],["Wed",18],["Wed",19],["Wed",20],["Wed",21],["Wed",22],["Wed",23]],"data":[13716,8163,5350,6930,8806,13450,23412,32061,31509,25230,24176,25188,25907,30341,36206,43673,48169,51961,54762,49595,43542,48323,49409,41260,6436,3737,2938,6232,9640,15032,23746,31159,29265,22197,20288,20333,20488,23385,28157,32744,38770,42023,37000,34159,32849,28925,20158,11811,27633,19189,12710,9542,6846,7084,8579,11014,14411,17669,20596,22718,24298,26636,31418,38769,43512,42844,45883,41098,38714,43826,47951,43174,32877,23015,15436,10597,6374,6169,6596,8728,12128,16401,19839,22856,23911,26417,28151,31112,33038,31521,28291,25948,25076,23967,19566,12166,9293,5290,3719,5637,8505,14169,27065,37038,35431,27812,25877,25966,26465,30840,36699,44442,50560,56704,55825,51907,51990,51953,44194,27764,6237,3509,2571,4494,7548,14241,26872,36599,33934,25023,23676,23679,23850,29075,34846,41338,48667,55500,50186,44789,44661,39913,27712,14869,7644,4324,3141,4855,7511,13794,26943,36495,33826,25635,24696,24963,25533,29183,35148,43388,50684,55637,52732,47017,47772,44553,32868,18146]};
var data15 = {"name":null,"index":[["Fri",0],["Fri",1],["Fri",2],["Fri",3],["Fri",4],["Fri",5],["Fri",6],["Fri",7],["Fri",8],["Fri",9],["Fri",10],["Fri",11],["Fri",12],["Fri",13],["Fri",14],["Fri",15],["Fri",16],["Fri",17],["Fri",18],["Fri",19],["Fri",20],["Fri",21],["Fri",22],["Fri",23],["Mon",0],["Mon",1],["Mon",2],["Mon",3],["Mon",4],["Mon",5],["Mon",6],["Mon",7],["Mon",8],["Mon",9],["Mon",10],["Mon",11],["Mon",12],["Mon",13],["Mon",14],["Mon",15],["Mon",16],["Mon",17],["Mon",18],["Mon",19],["Mon",20],["Mon",21],["Mon",22],["Mon",23],["Sat",0],["Sat",1],["Sat",2],["Sat",3],["Sat",4],["Sat",5],["Sat",6],["Sat",7],["Sat",8],["Sat",9],["Sat",10],["Sat",11],["Sat",12],["Sat",13],["Sat",14],["Sat",15],["Sat",16],["Sat",17],["Sat",18],["Sat",19],["Sat",20],["Sat",21],["Sat",22],["Sat",23],["Sun",0],["Sun",1],["Sun",2],["Sun",3],["Sun",4],["Sun",5],["Sun",6],["Sun",7],["Sun",8],["Sun",9],["Sun",10],["Sun",11],["Sun",12],["Sun",13],["Sun",14],["Sun",15],["Sun",16],["Sun",17],["Sun",18],["Sun",19],["Sun",20],["Sun",21],["Sun",22],["Sun",23],["Thu",0],["Thu",1],["Thu",2],["Thu",3],["Thu",4],["Thu",5],["Thu",6],["Thu",7],["Thu",8],["Thu",9],["Thu",10],["Thu",11],["Thu",12],["Thu",13],["Thu",14],["Thu",15],["Thu",16],["Thu",17],["Thu",18],["Thu",19],["Thu",20],["Thu",21],["Thu",22],["Thu",23],["Tue",0],["Tue",1],["Tue",2],["Tue",3],["Tue",4],["Tue",5],["Tue",6],["Tue",7],["Tue",8],["Tue",9],["Tue",10],["Tue",11],["Tue",12],["Tue",13],["Tue",14],["Tue",15],["Tue",16],["Tue",17],["Tue",18],["Tue",19],["Tue",20],["Tue",21],["Tue",22],["Tue",23],["Wed",0],["Wed",1],["Wed",2],["Wed",3],["Wed",4],["Wed",5],["Wed",6],["Wed",7],["Wed",8],["Wed",9],["Wed",10],["Wed",11],["Wed",12],["Wed",13],["Wed",14],["Wed",15],["Wed",16],["Wed",17],["Wed",18],["Wed",19],["Wed",20],["Wed",21],["Wed",22],["Wed",23]],"data":[85939,46616,28102,19518,23575,30220,48244,76593,100528,100719,82382,77323,77627,78384,87761,98874,113645,133914,156446,171715,162018,151694,162714,168020,50060,28139,16854,12698,19126,30747,49151,74513,97634,94270,75578,69820,68735,66291,73256,81491,88099,101830,117470,111399,103783,101626,91676,70006,145811,103689,71950,49893,37186,26454,27185,31932,44353,59879,73314,84448,92841,96831,98131,106156,124405,144664,154750,171540,163650,158899,170421,176181,156949,125564,87501,61720,42031,25794,23279,25293,34045,47678,65176,80029,88486,92717,96119,98610,104999,112096,113758,105099,96594,93761,96329,79155,66310,37832,25499,18877,20923,29380,48832,80451,103951,99270,77334,71885,72742,72732,81645,93578,108978,131500,157689,161285,153067,158702,155247,131889,44631,24787,14536,9910,14654,25461,46087,77522,102528,97278,74661,67117,66592,65739,74420,85273,97523,121235,145438,142675,133459,131787,119541,90048,52478,27883,16161,11039,15543,25467,45755,77239,100309,94343,71647,66094,65998,65215,73131,85432,99521,118751,141542,143751,136003,133993,127026,99490]};

var index14 = data14["index"];
var value14 = data14["data"];
for(var i = 0; i < index14.length; i++){
    index14[i].push(value14[i]);
}

var index15 = data15["index"];
var value15 = data15["data"];
for(var i = 0; i < index15.length; i++){
    index15[i].push(value15[i]);
}

createSankey(index14, "#data-2014", 2014);
createSankey(index15, "#data-2015", 2015);

function createSankey(data, selector, year){
    var color ={Sun:"#3366CC", Mon:"#DC3912",  Tue:"#FF9900", Wed:"#109618", Thu:"#990099", Fri:"#0099C6"};
    var svg = d3.select(selector).append("svg").attr("width", 960).attr("height", 800);

    svg.append("text").attr("x",250).attr("y",70)
        .attr("class","header").text("Uber Popularity By Day By Hour for " + year);

    var g =[svg.append("g").attr("transform","translate(150,100)")];

    var days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
    function sortDay(a, b){ return d3.ascending(days.indexOf(a),days.indexOf(b));}

    function sortHour(a, b){ return d3.ascending(parseInt(a), parseInt(b));}

    var bp=[ viz.bP()
            .data(data)
            .min(12)
            .pad(1)
            .height(600)
            .width(200)
            .barSize(35)
            .fill(d=>color[d.primary])
            .sortPrimary(sortDay)
            .sortSecondary(sortHour)
    ];
            
    [0].forEach(function(i){
        g[i].call(bp[i])
        
        g[i].append("text").attr("x",-50).attr("y",-8).style("text-anchor","middle").text("Day of Week");
        g[i].append("text").attr("x", 250).attr("y",-8).style("text-anchor","middle").text("Hour of Day");
        
        g[i].append("line").attr("x1",-100).attr("x2",0);
        g[i].append("line").attr("x1",200).attr("x2",300);
        
        g[i].append("line").attr("y1",610).attr("y2",610).attr("x1",-100).attr("x2",0);
        g[i].append("line").attr("y1",610).attr("y2",610).attr("x1",200).attr("x2",300);
        
        g[i].selectAll(".mainBars")
            .on("mouseover",mouseover)
            .on("mouseout",mouseout);

        function formatHour(key){
            var hour = parseInt(key);
            if(!isNaN(hour)){
                return (hour % 12 == 0 ? 12 : hour % 12) + (hour / 12 >= 1 ? " pm" : " am");
            }
            return key;
        }

        g[i].selectAll(".mainBars").append("text").attr("class","label")
            .attr("x",d=>(d.part=="primary"? -30: 30))
            .attr("y",d=>+6)
            .text(d=>formatHour(d.key))
            .attr("text-anchor",d=>(d.part=="primary"? "end": "start"));
        
        g[i].selectAll(".mainBars").append("text").attr("class","perc")
            .attr("x",d=>(d.part=="primary"? -100: 80))
            .attr("y",d=>+6)
            .text(function(d){ return d3.format("0.0%")(d.percent)})
            .attr("text-anchor",d=>(d.part=="primary"? "end": "start"));
    });

    function mouseover(d){
        [0].forEach(function(i){
            bp[i].mouseover(d);
            
            g[i].selectAll(".mainBars").select(".perc")
            .text(function(d){ return d3.format("0.0%")(d.percent)});
        });
    }
    function mouseout(d){
        [0].forEach(function(i){
            bp[i].mouseout(d);
            
            g[i].selectAll(".mainBars").select(".perc")
            .text(function(d){ return d3.format("0.0%")(d.percent)});
        });
    }
    d3.select(self.frameElement).style("height", "800px");
}