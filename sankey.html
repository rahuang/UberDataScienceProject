<!DOCTYPE html>
<meta charset="utf-8">
<style>
text{
    font-size:12px;
}
.mainBars rect{
  shape-rendering: auto;
  fill-opacity: 0;
  stroke-width: 0.5px;
  stroke: rgb(0, 0, 0);
  stroke-opacity: 0;
}
.subBars{
    shape-rendering:crispEdges;
}
.edges{
    stroke:none;
    fill-opacity:0.5;
}
.header{
    text-anchor:middle;
    font-size:16px;
}
line{
    stroke:grey;
}
</style>
<body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://vizjs.org/viz.v1.1.0.min.js"></script>
<script>

var data=[['Lite','CA',16],
['Small','CA',1278],
['Medium','CA',27],
['Plus','CA',58],
['Grand','CA',1551],
['Elite','CA',141,0],
['Lite','AZ',5453,35],
['Small','AZ',683,1],
['Medium','AZ',862,0],
['Grand','AZ',6228,30],
['Lite','AL',15001,449],
['Small','AL',527,3],
['Medium','AL',836,0],
['Plus','AL',28648,1419],
['Grand','AL',3,0],
['Lite','CO',13,0],
['Small','CO',396,0],
['Medium','CO',362,0],
['Plus','CO',78,10],
['Grand','CO',2473,32],
['Elite','CO',2063,64],
['Medium','DE',203,0],
['Grand','DE',686,2],
['Elite','DE',826,0],
['Lite','KS',1738,110],
['Small','KS',12925,13],
['Medium','KS',15413,0],
['Small','GA',2166,2],
['Medium','GA',86,0],
['Plus','GA',348,3],
['Grand','GA',4244,18],
['Elite','GA',1536,1],
['Small','IA',351,0],
['Grand','IA',405,1],
['Small','IL',914,1],
['Medium','IL',127,0],
['Grand','IL',1470,7],
['Elite','IL',516,1],
['Lite','IN',43,0],
['Small','IN',667,1],
['Medium','IN',172,0],
['Plus','IN',149,1],
['Grand','IN',1380,5],
['Elite','IN',791,23],
['Small','FL',1,0],
['Grand','FL',1,0],
['Small','MD',1070,1],
['Grand','MD',1171,2],
['Elite','MD',33,0],
['Plus','TX',1,0],
['Small','MS',407,0],
['Medium','MS',3,0],
['Grand','MS',457,2],
['Elite','MS',20,0],
['Small','NC',557,0],
['Medium','NC',167,0],
['Plus','NC',95,1],
['Grand','NC',1090,5],
['Elite','NC',676,6],
['Lite','NM',1195,99],
['Small','NM',350,3],
['Medium','NM',212,0],
['Grand','NM',1509,8],
['Lite','NV',3899,389],
['Small','NV',147,0],
['Medium','NV',455,0],
['Plus','NV',1,1],
['Grand','NV',4100,16],
['Lite','OH',12,0],
['Small','OH',634,2],
['Medium','OH',749,0],
['Plus','OH',119,1],
['Grand','OH',3705,19],
['Elite','OH',3456,25],
['Small','PA',828,2],
['Medium','PA',288,0],
['Plus','PA',141,0],
['Grand','PA',2625,7],
['Elite','PA',1920,10],
['Small','SC',1146,2],
['Medium','SC',212,0],
['Plus','SC',223,4],
['Grand','SC',1803,6],
['Elite','SC',761,8],
['Small','TN',527,0],
['Medium','TN',90,0],
['Grand','TN',930,4],
['Elite','TN',395,1],
['Lite','ME',7232,58],
['Small','ME',1272,0],
['Medium','ME',1896,0],
['Plus','ME',1,0],
['Grand','ME',10782,33],
['Elite','ME',1911,3],
['Small','VA',495,0],
['Medium','VA',32,0],
['Plus','VA',7,0],
['Grand','VA',1557,12],
['Elite','VA',24,0],
['Small','WA',460,1],
['Plus','WA',88,3],
['Grand','WA',956,3],
['Small','WV',232,0],
['Medium','WV',71,0],
['Grand','WV',575,2],
['Elite','WV',368,3]
];

var data2 = {"name":null,"index":[["Fri",0],["Fri",1],["Fri",2],["Fri",3],["Fri",4],["Fri",5],["Fri",6],["Fri",7],["Fri",8],["Fri",9],["Fri",10],["Fri",11],["Fri",12],["Fri",13],["Fri",14],["Fri",15],["Fri",16],["Fri",17],["Fri",18],["Fri",19],["Fri",20],["Fri",21],["Fri",22],["Fri",23],["Mon",0],["Mon",1],["Mon",2],["Mon",3],["Mon",4],["Mon",5],["Mon",6],["Mon",7],["Mon",8],["Mon",9],["Mon",10],["Mon",11],["Mon",12],["Mon",13],["Mon",14],["Mon",15],["Mon",16],["Mon",17],["Mon",18],["Mon",19],["Mon",20],["Mon",21],["Mon",22],["Mon",23],["Sat",0],["Sat",1],["Sat",2],["Sat",3],["Sat",4],["Sat",5],["Sat",6],["Sat",7],["Sat",8],["Sat",9],["Sat",10],["Sat",11],["Sat",12],["Sat",13],["Sat",14],["Sat",15],["Sat",16],["Sat",17],["Sat",18],["Sat",19],["Sat",20],["Sat",21],["Sat",22],["Sat",23],["Sun",0],["Sun",1],["Sun",2],["Sun",3],["Sun",4],["Sun",5],["Sun",6],["Sun",7],["Sun",8],["Sun",9],["Sun",10],["Sun",11],["Sun",12],["Sun",13],["Sun",14],["Sun",15],["Sun",16],["Sun",17],["Sun",18],["Sun",19],["Sun",20],["Sun",21],["Sun",22],["Sun",23],["Thu",0],["Thu",1],["Thu",2],["Thu",3],["Thu",4],["Thu",5],["Thu",6],["Thu",7],["Thu",8],["Thu",9],["Thu",10],["Thu",11],["Thu",12],["Thu",13],["Thu",14],["Thu",15],["Thu",16],["Thu",17],["Thu",18],["Thu",19],["Thu",20],["Thu",21],["Thu",22],["Thu",23],["Tue",0],["Tue",1],["Tue",2],["Tue",3],["Tue",4],["Tue",5],["Tue",6],["Tue",7],["Tue",8],["Tue",9],["Tue",10],["Tue",11],["Tue",12],["Tue",13],["Tue",14],["Tue",15],["Tue",16],["Tue",17],["Tue",18],["Tue",19],["Tue",20],["Tue",21],["Tue",22],["Tue",23],["Wed",0],["Wed",1],["Wed",2],["Wed",3],["Wed",4],["Wed",5],["Wed",6],["Wed",7],["Wed",8],["Wed",9],["Wed",10],["Wed",11],["Wed",12],["Wed",13],["Wed",14],["Wed",15],["Wed",16],["Wed",17],["Wed",18],["Wed",19],["Wed",20],["Wed",21],["Wed",22],["Wed",23]],"data":[13716,8163,5350,6930,8806,13450,23412,32061,31509,25230,24176,25188,25907,30341,36206,43673,48169,51961,54762,49595,43542,48323,49409,41260,6436,3737,2938,6232,9640,15032,23746,31159,29265,22197,20288,20333,20488,23385,28157,32744,38770,42023,37000,34159,32849,28925,20158,11811,27633,19189,12710,9542,6846,7084,8579,11014,14411,17669,20596,22718,24298,26636,31418,38769,43512,42844,45883,41098,38714,43826,47951,43174,32877,23015,15436,10597,6374,6169,6596,8728,12128,16401,19839,22856,23911,26417,28151,31112,33038,31521,28291,25948,25076,23967,19566,12166,9293,5290,3719,5637,8505,14169,27065,37038,35431,27812,25877,25966,26465,30840,36699,44442,50560,56704,55825,51907,51990,51953,44194,27764,6237,3509,2571,4494,7548,14241,26872,36599,33934,25023,23676,23679,23850,29075,34846,41338,48667,55500,50186,44789,44661,39913,27712,14869,7644,4324,3141,4855,7511,13794,26943,36495,33826,25635,24696,24963,25533,29183,35148,43388,50684,55637,52732,47017,47772,44553,32868,18146]};
var data3 = {"name":null,"index":[[0,"Fri"],[0,"Mon"],[0,"Sat"],[0,"Sun"],[0,"Thu"],[0,"Tue"],[0,"Wed"],[1,"Fri"],[1,"Mon"],[1,"Sat"],[1,"Sun"],[1,"Thu"],[1,"Tue"],[1,"Wed"],[2,"Fri"],[2,"Mon"],[2,"Sat"],[2,"Sun"],[2,"Thu"],[2,"Tue"],[2,"Wed"],[3,"Fri"],[3,"Mon"],[3,"Sat"],[3,"Sun"],[3,"Thu"],[3,"Tue"],[3,"Wed"],[4,"Fri"],[4,"Mon"],[4,"Sat"],[4,"Sun"],[4,"Thu"],[4,"Tue"],[4,"Wed"],[5,"Fri"],[5,"Mon"],[5,"Sat"],[5,"Sun"],[5,"Thu"],[5,"Tue"],[5,"Wed"],[6,"Fri"],[6,"Mon"],[6,"Sat"],[6,"Sun"],[6,"Thu"],[6,"Tue"],[6,"Wed"],[7,"Fri"],[7,"Mon"],[7,"Sat"],[7,"Sun"],[7,"Thu"],[7,"Tue"],[7,"Wed"],[8,"Fri"],[8,"Mon"],[8,"Sat"],[8,"Sun"],[8,"Thu"],[8,"Tue"],[8,"Wed"],[9,"Fri"],[9,"Mon"],[9,"Sat"],[9,"Sun"],[9,"Thu"],[9,"Tue"],[9,"Wed"],[10,"Fri"],[10,"Mon"],[10,"Sat"],[10,"Sun"],[10,"Thu"],[10,"Tue"],[10,"Wed"],[11,"Fri"],[11,"Mon"],[11,"Sat"],[11,"Sun"],[11,"Thu"],[11,"Tue"],[11,"Wed"],[12,"Fri"],[12,"Mon"],[12,"Sat"],[12,"Sun"],[12,"Thu"],[12,"Tue"],[12,"Wed"],[13,"Fri"],[13,"Mon"],[13,"Sat"],[13,"Sun"],[13,"Thu"],[13,"Tue"],[13,"Wed"],[14,"Fri"],[14,"Mon"],[14,"Sat"],[14,"Sun"],[14,"Thu"],[14,"Tue"],[14,"Wed"],[15,"Fri"],[15,"Mon"],[15,"Sat"],[15,"Sun"],[15,"Thu"],[15,"Tue"],[15,"Wed"],[16,"Fri"],[16,"Mon"],[16,"Sat"],[16,"Sun"],[16,"Thu"],[16,"Tue"],[16,"Wed"],[17,"Fri"],[17,"Mon"],[17,"Sat"],[17,"Sun"],[17,"Thu"],[17,"Tue"],[17,"Wed"],[18,"Fri"],[18,"Mon"],[18,"Sat"],[18,"Sun"],[18,"Thu"],[18,"Tue"],[18,"Wed"],[19,"Fri"],[19,"Mon"],[19,"Sat"],[19,"Sun"],[19,"Thu"],[19,"Tue"],[19,"Wed"],[20,"Fri"],[20,"Mon"],[20,"Sat"],[20,"Sun"],[20,"Thu"],[20,"Tue"],[20,"Wed"],[21,"Fri"],[21,"Mon"],[21,"Sat"],[21,"Sun"],[21,"Thu"],[21,"Tue"],[21,"Wed"],[22,"Fri"],[22,"Mon"],[22,"Sat"],[22,"Sun"],[22,"Thu"],[22,"Tue"],[22,"Wed"],[23,"Fri"],[23,"Mon"],[23,"Sat"],[23,"Sun"],[23,"Thu"],[23,"Tue"],[23,"Wed"]],"data":[13716,6436,27633,32877,9293,6237,7644,8163,3737,19189,23015,5290,3509,4324,5350,2938,12710,15436,3719,2571,3141,6930,6232,9542,10597,5637,4494,4855,8806,9640,6846,6374,8505,7548,7511,13450,15032,7084,6169,14169,14241,13794,23412,23746,8579,6596,27065,26872,26943,32061,31159,11014,8728,37038,36599,36495,31509,29265,14411,12128,35431,33934,33826,25230,22197,17669,16401,27812,25023,25635,24176,20288,20596,19839,25877,23676,24696,25188,20333,22718,22856,25966,23679,24963,25907,20488,24298,23911,26465,23850,25533,30341,23385,26636,26417,30840,29075,29183,36206,28157,31418,28151,36699,34846,35148,43673,32744,38769,31112,44442,41338,43388,48169,38770,43512,33038,50560,48667,50684,51961,42023,42844,31521,56704,55500,55637,54762,37000,45883,28291,55825,50186,52732,49595,34159,41098,25948,51907,44789,47017,43542,32849,38714,25076,51990,44661,47772,48323,28925,43826,23967,51953,39913,44553,49409,20158,47951,19566,44194,27712,32868,41260,11811,43174,12166,27764,14869,18146]};

var index = data2["index"];
var value = data2["data"];
for(var i = 0; i < index.length; i++){
    index[i].push(value[i]);
}
var value2 = data3["data"];
for(var i = 0; i < 7; i++){
    for(var j = 0; j < 24; j++){
        index[(i*24) + j].push(value2[(j*7) + i]);
        // console.log((j*7) + i);
        // console.log((i*24) + j);
    }
}

var color ={Sun:"#3366CC", Mon:"#DC3912",  Tue:"#FF9900", Wed:"#109618", Thu:"#990099", Fri:"#0099C6"};
var svg = d3.select("body").append("svg").attr("width", 960).attr("height", 800);

svg.append("text").attr("x",250).attr("y",70)
    .attr("class","header").text("Uber Popularity By Day By Hour");

var g =[svg.append("g").attr("transform","translate(150,100)")];

var bp=[ viz.bP()
        .data(index)
        .min(12)
        .pad(1)
        .height(600)
        .width(200)
        .barSize(35)
        .fill(d=>color[d.primary])
];
        
[0].forEach(function(i){
    g[i].call(bp[i])
    
    g[i].append("text").attr("x",-50).attr("y",-8).style("text-anchor","middle").text("Day of Week");
    g[i].append("text").attr("x", 250).attr("y",-8).style("text-anchor","middle").text("Hour of Day");
    
    g[i].append("line").attr("x1",-100).attr("x2",0);
    g[i].append("line").attr("x1",200).attr("x2",300);
    
    g[i].append("line").attr("y1",610).attr("y2",610).attr("x1",-100).attr("x2",0);
    g[i].append("line").attr("y1",610).attr("y2",610).attr("x1",200).attr("x2",300);
    
    g[i].selectAll(".mainBars")
        .on("mouseover",mouseover)
        .on("mouseout",mouseout);

    g[i].selectAll(".mainBars").append("text").attr("class","label")
        .attr("x",d=>(d.part=="primary"? -30: 30))
        .attr("y",d=>+6)
        .text(d=>d.key)
        .attr("text-anchor",d=>(d.part=="primary"? "end": "start"));
    
    g[i].selectAll(".mainBars").append("text").attr("class","perc")
        .attr("x",d=>(d.part=="primary"? -100: 80))
        .attr("y",d=>+6)
        .text(function(d){ return d3.format("0.0%")(d.percent)})
        .attr("text-anchor",d=>(d.part=="primary"? "end": "start"));
});

function mouseover(d){
    [0].forEach(function(i){
        bp[i].mouseover(d);
        
        g[i].selectAll(".mainBars").select(".perc")
        .text(function(d){ return d3.format("0.0%")(d.percent)});
    });
}
function mouseout(d){
    [0].forEach(function(i){
        bp[i].mouseout(d);
        
        g[i].selectAll(".mainBars").select(".perc")
        .text(function(d){ return d3.format("0.0%")(d.percent)});
    });
}
d3.select(self.frameElement).style("height", "800px");
</script>
</body>
</html>